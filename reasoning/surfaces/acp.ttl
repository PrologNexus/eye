# -----------------------------
# Access Control Policy example
# -----------------------------

@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix log: <http://www.w3.org/2000/10/swap/log#> .
@prefix list: <http://www.w3.org/2000/10/swap/list#> .
@prefix : <http://example.org/#> .

:test1
    :policy :PolicyX ;
    :has :A , :B , :C .

:PolicyX
    a :Policy ;
    :allOf :A, :B ;
    :anyOf :C ;
    :noneOf :D .


(_:Pol _:Test _:Field _:X) log:not (log:and
    _:Test :policy _:Pol

    _:Pol rdf:type :Policy

    (
        (log:and
            _:Pol :allOf _:Field
        )
        (log:and
            _:Test :has _:Field
        )
    ) log:forAllIn _:X

    () log:not (log:and
        _:Pol :pass :allOfTest
    )
) .

(_:Pol _:Test _:Field _:List _:L _:X) log:not (log:and
    _:Test :policy _:Pol

    _:Pol rdf:type :Policy

    (
        _:Field
        (log:and
            _:Pol :anyOf _:Field
            _:Test :has _:Field
        )
        _:List
    ) log:collectAllIn _:X

    _:List list:length _:L

    _:L log:notEqualTo 0

    () log:not (log:and
        _:Pol :pass :anyOfTest
    )
) .

(_:Pol _:Test _:Field _:List _:L _:X) log:not (log:and
    _:Test :policy _:Pol

    _:Pol rdf:type :Policy

    (
        _:Field
        (log:and
            _:Pol :noneOf _:Field
            _:Test :has _:Field
        )
        _:List
    ) log:collectAllIn _:X

    _:List list:length _:L

    _:L log:equalTo 0

    () log:not (log:and
        _:Pol :pass :noneOfTest
    )
) .

(_:Pol) log:not (log:and
    _:Pol rdf:type :Policy

    _:Pol :pass :allOfTest
    _:Pol :pass :anyOfTest
    _:Pol :pass :noneOfTest

    () log:not (log:and
        :test :is true
    )
) .

# query
(_:S) log:not (log:and
    _:S :is true
    () log:not (log:answer
        _:S :is true
    )
) .
