@prefix log: <http://www.w3.org/2000/10/swap/log#>.
@prefix : <http://example.org/ns#>.

# sample data
:n1 :p1 :n2; a :C1.
:n1 :p2 :n3.
:n1 :p3 :n4.
:n2 :p2 :n3.
:n3 :p4 :n5; a :C2.
:n3 :p5 :n6.
:n3 :p2 :n1.
:n6 :p6 :n7; a :C3.

# categorize
(?A ?B ?C ?D) log:onNegativeSurface {
    ?A a ?B.
    ?A ?C ?D.
    () log:onNegativeSurface {
        <<?A ?C ?D>> :category ?B.
    }.
}.

(?A ?B ?C ?D ?E ?F ?G ?H) log:onNegativeSurface {
    <<?A ?B ?C>> :category ?D.
    ?C ?E ?F.
    (?G {?C a ?G} ()) log:collectAllIn ?H.
    () log:onNegativeSurface {
        <<?C ?E ?F>> :category ?D.
    }.
}.

# query
(?A ?B) log:onQuerySurface {
    ?A :category ?B.
}.
