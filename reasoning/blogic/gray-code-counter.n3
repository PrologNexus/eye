# Gray Code Counter
# See https://en.wikipedia.org/wiki/Gray_code
# Taken from the book "Clause and Effect" Chapter 8

@prefix log: <http://www.w3.org/2000/10/swap/log#>.
@prefix list: <http://www.w3.org/2000/10/swap/list#>.
@prefix : <http://example.org/ns#>.

(0 0) :and 0.
(0 1) :and 0.
(1 0) :and 0.
(1 1) :and 1.

(0 0) :or 0.
(0 1) :or 1.
(1 0) :or 1.
(1 1) :or 1.

0 :inv 1.
1 :inv 0.

(_D _Q) log:onNegativeSurface {
    () log:onNegativeSurface <<(_D 0 _Q) :dff _Q>>.
}.

(_D _Q) log:onNegativeSurface {
    () log:onNegativeSurface <<(_D 1 _Q) :dff _D>>.
}.

(_A _B _Q _T1 _NA _NB _T2) log:onNegativeSurface {
    () log:onNegativeSurface <<(_A _B) :neta _Q>>.
    (_A _B) :and _T1.
    _A :inv _NA.
    _B :inv _NB.
    (_NA _NB) :and _T2.
    (_T1 _T2) :or _Q.
}.

(_A _B _C _Q1 _Q2 _T1 _NC _T2 _NA _T3) log:onNegativeSurface {
    () log:onNegativeSurface <<(_A _B _C) :netb (_Q1 _Q2)>>.
    (_A _C) :and _T1.
    _C :inv _NC.
    (_B _NC) :and _T2.
    _A :inv _NA.
    (_NA _C) :and _T3.
    (_T1 _T2) :or _Q1.
    (_T2 _T3) :or _Q2.
}.


(_C _Qa _Qb _Qc _Za _Zb _Zc _D1 _D2 _D3) log:onNegativeSurface {
    () log:onNegativeSurface <<(_C (_Qa _Qb _Qc)) :gcc (_Za _Zb _Zc)>>.
    (_Qa _Qb _Qc) :netb (_D1 _D2).
    (_Qa _Qb) :neta _D3.
    (_D1 _C _Qa) :dff _Za.
    (_D2 _C _Qb) :dff _Zb.
    (_D3 _C _Qc) :dff _Zc.
}.


(_S) log:onNegativeSurface {
    () log:onNegativeSurface <<(() _S) :testgcc ()>>.
}.

(_Cc _S _Nc _C _Cs _N _Ns) log:onNegativeSurface {
    () log:onNegativeSurface <<(_Cc _S) :testgcc _Nc>>.
    _Cc list:firstRest (_C _Cs).
    _Nc list:firstRest (_N _Ns).
    (_C _S) :gcc _N.
    (_Cs _N) :testgcc _Ns.
}.

# query
(_Q) log:onQuerySurface {
    ((1 1 1 1 1 1 1 1 1) (0 0 0)) :testgcc _Q.
}.
