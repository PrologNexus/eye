# Dijkstra's algorithm to find the shortest path
# Original from https://github.com/agx-r/Dijkstra-s-Algorithm

@prefix list: <http://www.w3.org/2000/10/swap/list#>.
@prefix math: <http://www.w3.org/2000/10/swap/math#>.
@prefix log: <http://www.w3.org/2000/10/swap/log#>.
@prefix : <urn:example:>.

# edges
(:a :b) :edge 4 .
(:a :c) :edge 2 .
(:b :c) :edge 1 .
(:b :d) :edge 5 .
(:c :d) :edge 8 .
(:c :e) :edge 10 .
(:d :e) :edge 2 .
(:d :f) :edge 6 .
(:e :f) :edge 3 .

{
    (?A ?B) :edge ?C.
} => {
    (?B ?A) :edge ?C.
}.

# Dijkstra's algorithm
{ (?Start ?Goal) :dijkstra (?Path ?Cost) } <= {
    (((0 ?Start)) ?Goal ()) :dijkstra (?RevPath ?Cost).
    ?RevPath list:reverse ?Path.
}.

{ (((?Cost ?Goal|?Path)|?Queue) ?Goal ?Visited) :dijkstra ((?Goal|?Path) ?Cost) } <= true.

{
 (((?Cost ?Node|?Path)|?Queue) ?Goal ?Visited) :dijkstra (?ResultPath ?ResultCost) } <= {
    ((?NewCost ?Neighbor ?Node|?Path) {
        (?Node ?Neighbor) :edge ?Weight.
        ?Visited list:notMember ?Neighbor.
        (?Cost ?Weight) math:sum ?NewCost.
    } ?Neighbors) log:collectAllIn ?SCOPE.
    (?Queue ?Neighbors) list:append ?NewQueue.
    ?NewQueue list:sort ?SortedQueue.
    (?SortedQueue ?Goal (?Node|?Visited)) :dijkstra (?ResultPath ?ResultCost).
}.
