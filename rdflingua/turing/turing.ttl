@prefix list: <http://www.w3.org/2000/10/swap/list#>.
@prefix log: <http://www.w3.org/2000/10/swap/log#>.
@prefix rule: <http://www.w3.org/2000/10/swap/rule#>.
@prefix : <http://example.org/ns#>.

# interpreter for Turing machine
:turing_rule1 a rule:BackwardRule;
    rule:vars (
        _:OutTape
        _:Machine
        _:I
    );
    rule:conclusion (
        (() :compute _:OutTape)
    );
    rule:premise (
        (_:Machine :start _:I)
        ((_:I () "#" ()) :find _:OutTape)
    ).

:turing_rule2 a rule:BackwardRule;
    rule:vars (
        _:List
        _:OutTape
        _:Head
        _:Tail
        _:Machine
        _:I
    );
    rule:conclusion (
        (_:List :compute _:OutTape)
    );
    rule:premise (
        (_:List list:firstRest (_:Head _:Tail))
        (_:Machine :start _:I)
        ((_:I () _:Head _:Tail) :find _:OutTape)
    ).

:turing_rule3 a rule:BackwardRule;
    rule:vars (
        _:State
        _:Left
        _:Cell
        _:Right
        _:OutTape
        _:Write
        _:Move
        _:Next
        _:A
        _:B
        _:C
    );
    rule:conclusion (
        ((_:State _:Left _:Cell _:Right) :find _:OutTape)
    );
    rule:premise (
        ((_:State _:Cell _:Write _:Move) :tape _:Next)
        ((_:Move _:Left _:Write _:Right _:A _:B _:C) :move true)
        ((_:Next _:A _:B _:C) :continue _:OutTape)
    ).

:turing_rule4 a rule:BackwardRule;
    rule:vars (
        _:Left
        _:Cell
        _:Right
        _:OutTape
        _:R
        _:List
    );
    rule:conclusion (
        ((:halt _:Left _:Cell _:Right) :continue _:OutTape)
    );
    rule:premise (
        (_:Left :reverse _:R)
        (_:List list:firstRest (_:Cell _:Right))
        ((_:R _:List) list:append _:OutTape)
    ).

:turing_rule5 a rule:BackwardRule;
    rule:vars (
        _:State
        _:Left
        _:Cell
        _:Right
        _:OutTape
    );
    rule:conclusion (
        ((_:State _:Left _:Cell _:Right) :continue _:OutTape)
    );
    rule:premise (
        ((_:State _:Left _:Cell _:Right) :find _:OutTape)
    ).

:turing_rule6 a rule:BackwardRule;
    rule:vars (
        _:Cell
        _:Right
        _:L
    );
    rule:conclusion (
        ((:left () _:Cell _:Right () "#" _:L) :move true)
    );
    rule:premise (
        (_:L list:firstRest (_:Cell _:Right))
    ).

:turing_rule7 a rule:BackwardRule;
    rule:vars (
        _:List
        _:Cell
        _:Right
        _:Tail
        _:Head
        _:L
    );
    rule:conclusion (
        ((:left _:List _:Cell _:Right _:Tail _:Head _:L) :move true)
    );
    rule:premise (
        (_:List list:firstRest (_:Head _:Tail))
        (_:L list:firstRest (_:Cell _:Right))
    ).

:turing_rule8 a rule:BackwardRule;
    rule:vars (
        _:Left
        _:Cell
        _:Right
    );
    rule:conclusion (
        ((:stop _:Left _:Cell _:Right _:Left _:Cell _:Right) :move true)
    );
    rule:premise ().

:turing_rule9 a rule:BackwardRule;
    rule:vars (
        _:Left
        _:Cell
        _:L
    );
    rule:conclusion (
        ((:right _:Left _:Cell () _:L "#" ()) :move true)
    );
    rule:premise (
        (_:L list:firstRest (_:Cell _:Left))
    ).

:turing_rule10 a rule:BackwardRule;
    rule:vars (
        _:Left
        _:Cell
        _:List
        _:L
        _:Head
        _:Tail
    );
    rule:conclusion (
        ((:right _:Left _:Cell _:List _:L _:Head _:Tail) :move true)
    );
    rule:premise (
        (_:List list:firstRest (_:Head _:Tail))
        (_:L list:firstRest (_:Cell _:Left))
    ).

:turing_rule11 a rule:BackwardRule;
    rule:vars ();
    rule:conclusion (
        (() :reverse ())
    );
    rule:premise ().

:turing_rule12 a rule:BackwardRule;
    rule:vars (
        _:List
        _:Reverse
        _:Head
        _:Tail
        _:R
    );
    rule:conclusion (
        (_:List :reverse _:Reverse)
    );
    rule:premise (
        (_:List list:firstRest (_:Head _:Tail))
        (_:Tail :reverse _:R)
        ((_:R (_:Head)) list:append _:Reverse)
    ).

# a Turing machine to add 1 to a binary number
:add1 :start 0.

(0 0 0 :right) :tape 0.
(0 1 1 :right) :tape 0.
(0 "#" "#" :left) :tape 1.
(1 0 1 :stop) :tape :halt.
(1 1 0 :left) :tape 1.
(1 "#" 1 :stop) :tape :halt.

# query
:turing_query a rule:QueryRule;
    rule:vars (
        _:A1
        _:A2
        _:A3
        _:A4
    );
    rule:premise (
        ((1 0 1 0 0 1) :compute _:A1)
        ((1 0 1 1 1 1) :compute _:A2)
        ((1 1 1 1 1 1) :compute _:A3)
        (() :compute _:A4)
    );
    rule:conclusion (
        ((1 0 1 0 0 1) :compute _:A1)
        ((1 0 1 1 1 1) :compute _:A2)
        ((1 1 1 1 1 1) :compute _:A3)
        (() :compute _:A4)
    ).
