# ----------------
# Meta-interpreter
# ----------------
#
# Inspired by https://www.metalevel.at/acomip/

@prefix list: <http://www.w3.org/2000/10/swap/list#>.
@prefix lingua: <http://www.w3.org/2000/10/swap/lingua#>.
@prefix term: <http://www.w3.org/2000/10/swap/term#>.
@prefix var: <http://www.w3.org/2000/10/swap/var#>.
@prefix : <#>.

# meta-interpreter rules
:mi_rule1 lingua:head term:mi_rule1_head;
    lingua:body true.

term:mi_rule1_head {
    () :mi ().
}

:mi_rule2 lingua:head term:mi_rule2_head;
    lingua:body term:mi_rule2_body.

term:mi_rule2_head {
    () :mi var:A.
}

term:mi_rule2_body {
    var:A list:firstRest (var:G var:Gs).
    () :headBody (var:G var:Goals var:Gs).
    () :mi var:Goals.
}

# general head-body rules
:hb_rule1 lingua:head term:hb_rule1_head;
    lingua:body true.

term:hb_rule1_head {
    () :headBody (term:hb_rule1_head_graph1 var:Rs var:Rs).
}

term:hb_rule1_head_graph1 {
    () :mi ().
}

:hb_rule2 lingua:head term:hb_rule2_head;
    lingua:body term:hb_rule2_body.

term:hb_rule2_head {
    () :headBody (term:hb_rule2_head_graph1 var:B var:Rs).
}

term:hb_rule2_head_graph1 {
    () :mi var:A.
}

term:hb_rule2_body {
    var:A list:firstRest (var:G var:Gs).
    var:B list:firstRest (term:hb_rule2_body_graph1 var:C).
    var:C list:firstRest (term:hb_rule2_body_graph2 var:Rs).
}

term:hb_rule2_body_graph1 {
    () :headBody (var:G var:Goals var:Gs).
}

term:hb_rule2_body_graph2 {
    () :mi var:Goals.
}

:hb_rule3 lingua:head term:hb_rule3_head;
    lingua:body term:hb_rule3_body.

term:hb_rule3_head {
    () :headBody (term:hb_rule3_head_graph1 var:Rs var:Rs).
}

term:hb_rule3_head_graph1 {
    () :headBody (var:Head var:Goals0 var:Goals).
}

term:hb_rule3_body {
    () :headBody (var:Head var:Goals0 var:Goals).
}

# natnum head-body rules
:natnum_hb_rule1 lingua:head term:natnum_hb_rule1_head;
    lingua:body true.

term:natnum_hb_rule1_head {
    () :headBody (term:natnum_hb_rule1_head_graph1 var:Rs var:Rs).
}

term:natnum_hb_rule1_head_graph1 {
    () :natnum (0).
}

:natnum_hb_rule2 lingua:head term:natnum_hb_rule2_head;
    lingua:body term:natnum_hb_rule2_body.

term:natnum_hb_rule2_head {
    () :headBody (term:natnum_hb_rule2_head_graph1 var:A var:Rs).
}

term:natnum_hb_rule2_head_graph1 {
    () :natnum (:s var:X).
}

term:natnum_hb_rule2_body {
    var:A list:firstRest (term:natnum_hb_rule2_body_graph1 var:Rs).
}

term:natnum_hb_rule2_body_graph1 {
    () :natnum var:X.
}

# query
:query lingua:question term:question;
    lingua:answer term:answer.

term:question {
    () :mi (term:question_graph1).
}

term:question_graph1 {
    () :mi (term:question_graph2).
}

term:question_graph2 {
    () :mi (term:question_graph3).
}

term:question_graph3 {
    () :natnum (:s (:s (:s (:s (:s (0)))))).
}

term:answer {
    () :natnum (:s (:s (:s (:s (:s (0)))))).
}
